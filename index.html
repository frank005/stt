<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RTT Start</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jQuery (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

  <!-- Agora SDK -->
  <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>

  <!-- Protobuf (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/protobufjs/6.11.3/protobuf.min.js"></script>

  <!-- Update Protobuf references -->
  <script src="proto/protobuf.min.js"></script>
  <script src="proto/index.js"></script>

  <!-- Token builder (RTC only) - from convo_ai -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
  <script src="js/AccessToken2.js"></script>
  <script src="js/RtcTokenBuilder2.js"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/styles.css">
</head>

<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white min-h-screen">
  <!-- Add popup section at the top of body -->
  <div id="popup-section" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50"></div>

  <div class="max-w-7xl mx-auto">
    <div class="flex justify-between items-center mb-10">
      <div>
        <h1 class="text-3xl font-bold bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-500 bg-clip-text text-transparent mb-1">
          Agora Real-Time Transcription & Translation
        </h1>
        <p class="text-slate-400 text-sm">Live speech-to-text and translation demo</p>
      </div>
      
      <div class="flex gap-3 items-center">
        <button 
          onclick="loadConnectionFormFromStorage(); connectionModalSaved = false; document.getElementById('connectionModal').showModal()"
          class="modern-btn modern-btn-primary"
        >
          <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
          </svg>
          Connection Settings
        </button>
        
        <button 
          onclick="loadSTTFormFromStorage(); if (typeof loadTranslationSettings === 'function') loadTranslationSettings(); sttModalSaved = false; handleVersionChange(); document.getElementById('sttModal').showModal(); document.getElementById('request-preview').classList.add('hidden');"
          class="modern-btn modern-btn-success"
        >
          <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          STT Settings
        </button>

        <a href="https://github.com/AgoraIO-Community/agora-stt" 
           target="_blank" 
           class="text-gray-300 hover:text-white transition-colors"
           title="View on GitHub">
          <svg height="32" viewBox="0 0 16 16" width="32" class="fill-current">
            <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
          </svg>
        </a>
      </div>
    </div>

    <!-- Update local video template -->
    <div class="video-wrapper">
      <div class="language-selector">
        <select id="translation-lang-local" 
                class="language-select-dropdown" 
                onchange="updateTranslationView('local')">
        </select>
      </div>
      <div class="video-container">
        <div id="local-player" class="w-full h-full"></div>
        <div class="transcriptioncaps-overlay hidden">
          <div id="transcriptioncaps-local" class="text-xl mb-2"></div>
          <div id="translationcaps-local" class="text-gray-300"></div>
        </div>
        </div>
      </div>

    <!-- Remote videos -->
    <div id="remote-playerlist" class="remote-grid"></div>

    <!-- Control buttons -->
    <div class="flex gap-3 mt-8 flex-wrap">
      <button id="join" class="modern-btn modern-btn-primary">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        Join
      </button>
      <button id="leave" class="modern-btn modern-btn-danger opacity-50 cursor-not-allowed" disabled>
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        Leave
      </button>
      <button id="start-trans" class="modern-btn modern-btn-success opacity-50 cursor-not-allowed" disabled>
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
        </svg>
        Start RTT
      </button>
      <button id="stop-trans" class="modern-btn modern-btn-danger opacity-50 cursor-not-allowed" disabled>
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
        </svg>
        Stop RTT
      </button>
      <button id="view-transcripts" class="modern-btn modern-btn-secondary opacity-50 cursor-not-allowed" disabled onclick="openTranscriptsModal()" title="View transcript log">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        Transcripts
      </button>
    </div>

    <!-- Translation Control buttons (only visible when transcription is active) -->
    <div id="translation-controls" class="flex gap-3 mt-6 hidden items-center flex-wrap">
      <div class="flex items-center gap-3 px-4 py-2 bg-slate-800/50 rounded-lg border border-slate-700/50">
        <span class="text-sm text-slate-300">Translation:</span>
        <span id="translation-status" class="text-sm font-medium text-cyan-400">Disabled</span>
      </div>
      <button id="enable-translation" onclick="enableTranslationDuringSession()" class="modern-btn modern-btn-success">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        Enable
      </button>
      <button id="disable-translation" onclick="disableTranslationDuringSession()" class="modern-btn modern-btn-warning">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        Disable
      </button>
      <button onclick="showTranslationConfigModal()" class="modern-btn modern-btn-primary">
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
        Configure
      </button>
    </div>

    <!-- Connection Settings Modal -->
    <dialog id="connectionModal">
      <div class="flex items-center gap-3 mb-6 pb-4 border-b border-slate-700/50">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">Connection Settings</h2>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block mb-2">App ID</label>
          <input id="appid" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter App ID">
        </div>
        <div>
          <label class="block mb-2">App Certificate</label>
          <input id="app-certificate" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter App Certificate (for token generation)">
          <p class="text-gray-400 text-xs mt-1">Required only for generating RTC tokens. Not sent to the API.</p>
        </div>
        <div>
          <label class="block mb-2">Customer Key</label>
          <input id="key" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter customer key">
        </div>
        <div>
          <label class="block mb-2">Customer Secret</label>
          <input id="secret" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter customer secret">
        </div>
      </div>

      <div class="flex justify-end gap-4 mt-6">
        <button
          onclick="cancelConnectionModal()"
          class="modern-btn modern-btn-secondary"
        >
          Cancel
        </button>
        <button 
          onclick="saveConnectionSettings()"
          class="modern-btn modern-btn-primary"
        >
          Save
        </button>
      </div>
    </dialog>

    <!-- STT Settings Modal -->
    <dialog id="sttModal" class="stt-settings-modal">
      <div class="flex items-center gap-3 mb-8 pb-4 border-b border-slate-700/50">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-bold bg-gradient-to-r from-emerald-400 to-teal-500 bg-clip-text text-transparent">STT Settings</h2>
      </div>
      
      <!-- Inline alert for modal warnings -->
      <div id="stt-modal-alert" class="hidden bg-gradient-to-r from-red-600 to-rose-600 text-white px-4 py-3 rounded-lg mb-4 border border-red-500/50 shadow-lg shadow-red-500/20"></div>
      <div class="space-y-6">
        <!-- Version Selection -->
        <div>
          <label class="block mb-2">STT Version</label>
          <select id="stt-version" class="w-full bg-gray-800 rounded p-2" onchange="handleVersionChange()">
            <option value="6.x">6.x</option>
            <option value="7.x" selected>7.x</option>
          </select>
        </div>

        <!-- Channel and User (7.x: used in rtcConfig and join) -->
        <div>
          <label class="block mb-2">Channel Name</label>
          <input id="channel" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter channel name">
        </div>
        <div>
          <label class="block mb-2">User ID (optional)</label>
          <div class="flex items-center gap-3">
            <input id="uid" type="text" class="flex-1 bg-gray-800 rounded p-2" placeholder="Enter user ID">
            <label class="flex items-center text-xs gap-1.5 whitespace-nowrap">
              <input id="uid-string" type="checkbox" class="align-middle">
              Use string UID
            </label>
          </div>
        </div>
        <div>
          <label class="block mb-2">RTC Token (optional)</label>
          <div class="flex gap-2">
            <input id="join-token" type="text" class="flex-1 bg-gray-800 rounded p-2" placeholder="RTC token for joining (optional)">
            <button type="button" onclick="generateJoinRtcToken()" class="modern-btn modern-btn-secondary whitespace-nowrap" title="Generate RTC token for User ID above">Generate</button>
          </div>
          <p class="text-gray-400 text-xs mt-1">Uses Channel and User ID above. Empty UID = 0.</p>
        </div>

        <!-- Languages -->
        <div>
          <label class="block mb-2">Speaking Languages</label>
          <div id="speaking-languages" class="space-y-2">
            <div class="flex gap-2">
              <input type="text" class="flex-1 bg-gray-800 rounded p-2" value="en-US">
              <button onclick="addLanguageInput('speaking-languages')" class="modern-btn-icon">+</button>
            </div>
          </div>
          <p class="text-gray-400 text-sm mt-1">Maximum <span id="max-speaking-languages">2</span> speaking languages allowed</p>
        </div>

        <!-- Max Idle Time -->
        <div>
          <label class="block mb-2">Max Idle Time (seconds)</label>
          <input id="max-idle-time" type="number" class="w-full bg-gray-800 rounded p-2" value="60" min="10" max="300">
          <p class="text-gray-400 text-sm mt-1">Maximum time (in seconds) the service will wait for audio before stopping</p>
        </div>

        <!-- Translation -->
        <div>
          <label class="block mb-2">Translation Settings</label>
          <p class="text-gray-400 mb-4">Note: To enable translation, specify at least one source language and its target language(s).</p>
          
          <div id="translation-pairs" class="space-y-4">
            <div class="translation-pair border border-gray-700 p-4 rounded">
              <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                  <label class="block">Source Language</label>
                  <button onclick="this.closest('.translation-pair').remove(); saveTranslationSettings();" class="modern-btn-remove">Remove Pair</button>
        </div>
                <input type="text" class="source-lang w-full bg-gray-800 rounded p-2" placeholder="e.g., en-US">
              </div>
              <div class="target-languages space-y-2">
                <label class="block mb-2">Target Languages</label>
                <div class="flex gap-2">
                  <input type="text" class="flex-1 bg-gray-800 rounded p-2" placeholder="Target language (e.g., es-ES)">
                  <button onclick="addTargetLanguage(this)" class="modern-btn-icon">+</button>
                </div>
              </div>
            </div>
          </div>
          <button onclick="addTranslationPair()" class="mt-4 modern-btn modern-btn-primary">Add Translation Pair</button>
      </div>

        <!-- Bot Configuration -->
        <div class="border-t border-gray-700 pt-4">
          <h3 class="font-semibold mb-4">Bot Configuration</h3>
          <div class="settings-grid">
        <div>
              <label class="block mb-2">Sub Bot UID</label>
              <input id="puller-uid" type="text" class="w-full bg-gray-800 rounded p-2" value="666">
              <p class="text-gray-400 text-xs mt-1" id="sub-bot-note">Not used in 7.x version</p>
        </div>
        <div>
              <label class="block mb-2">Sub Bot Token (Optional)</label>
              <div class="flex gap-2">
                <input id="puller-token" type="text" class="flex-1 bg-gray-800 rounded p-2" placeholder="Enter sub bot token">
                <button type="button" onclick="generateRtcTokenForInput('puller-token', 'puller-uid')" class="modern-btn modern-btn-secondary whitespace-nowrap" title="Generate RTC token for Sub Bot UID">Generate</button>
              </div>
              <p class="text-gray-400 text-xs mt-1" id="sub-bot-token-note">Not used in 7.x version</p>
        </div>
            <div>
              <label class="block mb-2">Pub Bot UID</label>
              <input id="pusher-uid" type="text" class="w-full bg-gray-800 rounded p-2" value="66666">
      </div>
        <div>
              <label class="block mb-2">Pub Bot Token (Optional)</label>
              <div class="flex gap-2">
                <input id="pusher-token" type="text" class="flex-1 bg-gray-800 rounded p-2" placeholder="Enter pub bot token">
                <button type="button" onclick="generateRtcTokenForInput('pusher-token', 'pusher-uid')" class="modern-btn modern-btn-secondary whitespace-nowrap" title="Generate RTC token for Pub Bot UID">Generate</button>
              </div>
        </div>
          </div>
        </div>

        <!-- Encryption Settings -->
        <div class="border-t border-gray-700 pt-4">
          <h3 class="font-semibold mb-4">Encryption Settings</h3>
          <div class="settings-grid">
        <div>
              <label class="block mb-2">Decryption Mode</label>
              <input id="decryption-mode" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter mode (optional)">
        </div>
        <div>
              <label class="block mb-2">Secret</label>
              <input id="encryption-secret" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter secret (optional)">
        </div>
        <div>
              <label class="block mb-2">Salt</label>
              <input id="encryption-salt" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter salt (optional)">
            </div>
        </div>
      </div>

        <!-- Caption / Recording (7.x captionConfig) -->
        <div class="border-t border-gray-700 pt-4">
          <h3 class="font-semibold mb-4">Caption Recording</h3>
          <div>
            <label class="block mb-2">Slice Duration (seconds)</label>
            <input id="slice-duration" type="number" class="w-full bg-gray-800 rounded p-2" value="60" min="5" max="28800" placeholder="60">
            <p class="text-gray-400 text-sm mt-1">Slice size of the recorded subtitle file (5â€“28800). Default 60.</p>
          </div>
        </div>

        <!-- Storage Configuration -->
        <div class="border-t border-gray-700 pt-4">
          <h3 class="font-semibold mb-4">Storage Configuration</h3>
          <div class="settings-grid">
        <div>
              <label class="block mb-2">S3 Access Key</label>
              <input id="s3-access-key" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter access key">
        </div>
        <div>
              <label class="block mb-2">S3 Secret Key</label>
              <input id="s3-secret-key" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter secret key">
        </div>
            <div>
              <label class="block mb-2">S3 Bucket</label>
              <input id="s3-bucket" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter bucket name">
      </div>
            <div>
              <label class="block mb-2">S3 Region</label>
              <input id="s3-region" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter region">
      </div>
            <div>
              <label class="block mb-2">S3 Vendor</label>
              <input id="s3-vendor" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter vendor">
    </div>
            <div>
              <label class="block mb-2">File Name Prefix</label>
              <input id="s3-fileNamePrefix" type="text" class="w-full bg-gray-800 rounded p-2" placeholder="Enter prefix">
        </div>
        </div>
      </div>

        <!-- Request Preview -->
        <div class="border-t border-gray-700 pt-4">
          <h3 class="font-semibold mb-4">Request Preview</h3>
          <p class="text-gray-400 mb-4">Preview the request body that will be sent to start transcription:</p>
          <button 
            onclick="previewStartRequest()"
            class="modern-btn modern-btn-primary mb-4"
          >
            Preview Request
          </button>
          <div id="request-preview" class="hidden">
            <div class="flex justify-between items-center mb-2">
              <label class="block">Request Body (JSON)</label>
              <button 
                onclick="copyRequestToClipboard()"
                class="modern-btn modern-btn-success text-sm"
              >
                Copy
              </button>
            </div>
            <pre id="request-body" class="bg-gray-800 p-4 rounded text-sm overflow-x-auto whitespace-pre-wrap"></pre>
          </div>
        </div>
    </div>

      <div class="flex justify-end gap-4 mt-8">
        <button 
          onclick="cancelSTTModal()"
          class="modern-btn modern-btn-secondary"
        >
          Cancel
        </button>
        <button 
          onclick="saveSTTSettings()"
          class="modern-btn modern-btn-primary"
        >
          Save
        </button>
      </div>
    </dialog>

    <!-- Transcripts & Translations Modal -->
    <dialog id="transcriptsModal" class="transcripts-modal">
      <div class="flex items-center gap-3 mb-4 pb-4 border-b border-slate-700/50">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-bold bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">Transcripts & Translations</h2>
      </div>
      <div class="flex items-center gap-2 mb-3 flex-wrap">
        <span class="text-slate-400 text-sm">View:</span>
        <div id="transcripts-lang-tabs" class="flex rounded-lg border border-slate-600/50 overflow-hidden flex-wrap">
          <!-- Tabs filled by JS: By segment, then one per language (Original, Spanish, etc.) -->
        </div>
      </div>
      <div id="transcripts-modal-content" class="transcripts-modal-content overflow-y-auto max-h-[60vh] rounded-lg border border-slate-700/50 bg-slate-800/50 p-4 mb-4 text-left space-y-4">
        <p id="transcripts-empty" class="text-slate-400 text-sm">No final transcripts yet. Text appears here after each segment is finalized.</p>
      </div>
      <div class="flex justify-between items-center flex-wrap gap-3">
        <div class="flex gap-2">
          <button type="button" onclick="copyTranscriptsToClipboard()" class="modern-btn modern-btn-primary">
            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
            Copy
          </button>
          <button type="button" onclick="exportTranscriptsAsTxt()" class="modern-btn modern-btn-secondary">
            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
            </svg>
            Export as TXT
          </button>
        </div>
        <button type="button" onclick="this.closest('dialog').close()" class="modern-btn modern-btn-secondary">Close</button>
      </div>
    </dialog>

    <!-- Translation Configuration Modal -->
    <dialog id="translationConfigModal">
      <div class="flex items-center gap-3 mb-6 pb-4 border-b border-slate-700/50">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">Configure Translation Languages</h2>
      </div>
      
      <div class="space-y-4">
        <p class="text-gray-400 mb-4">Configure translation language pairs for the current session:</p>
        
        <div id="session-translation-pairs" class="space-y-4">
          <div class="translation-pair border border-gray-700 p-4 rounded">
            <div class="mb-4">
              <div class="flex justify-between items-center mb-2">
                <label class="block">Source Language</label>
                <button onclick="this.closest('.translation-pair').remove();" class="modern-btn-remove">Remove Pair</button>
              </div>
              <input type="text" class="source-lang w-full bg-gray-800 rounded p-2" placeholder="e.g., en-US">
            </div>
            <div class="target-languages space-y-2">
              <label class="block mb-2">Target Languages</label>
              <div class="flex gap-2">
                <input type="text" class="flex-1 bg-gray-800 rounded p-2" placeholder="Target language (e.g., es-ES)">
                <button onclick="addTargetLanguage(this)" class="bg-blue-600 px-3 rounded">+</button>
              </div>
            </div>
          </div>
        </div>
        
        <button onclick="addSessionTranslationPair()" class="mt-4 modern-btn modern-btn-primary">Add Translation Pair</button>
      </div>

      <div class="flex justify-end gap-4 mt-8">
        <button 
          onclick="this.closest('dialog').close()"
          class="modern-btn modern-btn-secondary"
        >
          Cancel
        </button>
        <button 
          onclick="updateTranslationLanguagesDuringSession()"
          class="modern-btn modern-btn-primary"
        >
          Update/Enable Languages
        </button>
      </div>
    </dialog>
  </div>

  <!-- JavaScript modules -->
  <script src="js/config.js"></script>
  <script src="js/agora-client.js"></script>
  <script src="js/transcription.js"></script>
  <script src="js/translation.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/settings.js"></script>
  <script src="js/main.js"></script>

</body>
</html>
